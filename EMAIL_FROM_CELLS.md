# セルのデータを取得してメールを作成する方法

## 概要

Excelのセルからデータを読み込んで、Outlookでメールを作成するVBAコードです。

## 準備

1. Outlookがインストールされていることを確認
2. VBAエディタで「ツール」→「参照設定」→「Microsoft Outlook xx.x Object Library」にチェック（オプション、なくても動作します）

## 使い方

### 1. CreateEmailFromCells（基本版）

特定のセルからデータを取得してメールを作成します。

**Excelシートの設定例：**
```
A列        B列
宛先       recipient@example.com
件名       月次報告について
名前       山田太郎
金額       100000
日付       2024/2/13
```

**コードの動作：**
- B2セル: 宛先メールアドレス
- B3セル: メールの件名
- B4セル: 名前
- B5セル: 金額
- B6セル: 日付

これらのデータを使ってメール本文を自動生成します。

**実行方法：**
1. VBAエディタで `CreateEmailFromCells` を実行
2. Outlookのメール作成ウィンドウが開きます
3. 内容を確認して送信

---

### 2. CreateEmailFromTable（テーブル形式）

テーブル形式のデータを読み込んで、メール本文に整形します。

**Excelシートの設定例：**
```
A1: 宛先    B1: recipient@example.com
A2: 件名    B2: データ報告
A3: (空行)
A4: 商品名  B4: 数量  C4: 単価  D4: 合計
A5: りんご  B5: 10    C5: 120   D5: 1200
A6: みかん  B6: 20    C6: 80    D6: 1600
```

**コードの動作：**
- B1セル: 宛先
- B2セル: 件名
- A4以降: テーブルデータ（見出し行 + データ行）

テーブル全体をメール本文に整形して表示します。

---

### 3. CreateMultipleEmails（複数メール作成）

各行ごとに個別のメールを作成します。

**Excelシートの設定例：**
```
A列（宛先）        B列（名前）    C列（金額）    D列（日付）
user1@example.com 山田太郎      50000         2024/2/13
user2@example.com 佐藤花子      30000         2024/2/14
user3@example.com 鈴木一郎      80000         2024/2/15
```

**コードの動作：**
- 各行ごとに個別のメールを作成
- 宛先、名前、金額、日付を読み込んでメール本文を生成
- 空の行は自動的にスキップ

**注意：**
- 大量のメールを作成する場合は、送信前に内容を確認してください
- 自動送信する場合は、コード内の `olMail.Display` を `olMail.Send` に変更

---

### 4. CreateEmailWithExcelTable（Excel範囲を貼り付け）

Excelの範囲をそのままメールに貼り付けます。

**使い方：**
- A4:D10の範囲を指定して、その範囲をメール本文に貼り付け
- 範囲はコード内の `ws.Range("A4:D10")` を変更して調整

---

## カスタマイズ方法

### セルの位置を変更する

コード内のセル参照（例：`ws.Range("B2")`）を変更してください。

```vba
' 例: C列の3行目から取得する場合
recipient = ws.Range("C3").Value
subject = ws.Range("C4").Value
```

### メール本文のテンプレートを変更する

`bodyText` に代入している文字列を編集してください。

```vba
bodyText = "カスタムメッセージ" & vbCrLf
bodyText = bodyText & "追加の内容"
```

### 自動送信にする

メールを確認せずに自動送信する場合は、`olMail.Display` を `olMail.Send` に変更してください。

```vba
' 確認してから送信（現在の設定）
olMail.Display

' 自動送信（コメントを外す）
' olMail.Send
```

---

## トラブルシューティング

### Outlookが起動しない

- Outlookがインストールされているか確認
- Outlookが起動しているか確認（バックグラウンドでも可）

### エラーが発生する

- セルの値が空の場合、エラーになる可能性があります
- エラーハンドリングを追加することをお勧めします

```vba
On Error GoTo ErrorHandler
' メール作成のコード
Exit Sub

ErrorHandler:
MsgBox "エラーが発生しました: " & Err.Description
```

### メールが送信されない

- `olMail.Display` の場合は、表示されたメールウィンドウから手動で送信してください
- 自動送信する場合は `olMail.Send` を使用してください

---

## セキュリティについて

- メールの自動送信は慎重に行ってください
- 送信前に内容を確認することをお勧めします
- 大量のメールを送信する場合は、迷惑メールと判断される可能性があります
